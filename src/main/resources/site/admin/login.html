<!DOCTYPE html>
<html lang = "en">

    <head>

        <meta charset = "utf-8"/>
        <meta name = "viewport" content = "width=device-width, initial-scale=1"/>
        <meta name = "description" content = "Personal GitHub projects showcase website. Admin login page."/>

        <link rel = "stylesheet" href = "../styles.css"/>
        <link rel = "icon" type = "image/x-icon" href = "../images/favicon.ico"/>

        <title>Gatto's Lab</title>

    </head>

    <body class = "background">

        <nav class = "navbar">

            <div class = "nav-container">

                <div class = "nav-item">
                    <img src = "../images/GITHUB-LOGO.svg" class = "nav-icon" alt = "GitHub logo"/>
                    <a href = "https://github.com/Clamentos" target = "_blank">Follow me on GitHub</a>
                </div>

            </div>

            <div class = "nav-crumb">
                <a href = "../index.html">Home</a> > Admin-login
            </div>

        </nav>

        <main>

            <div class = "login-container">

                <div class = "static-card">

                    <div class = "card-header" style = "background-color: white">
                        <img src = "../images/FABRISC-LOGO.png" alt = "FabRISC ISA project logo"/>
                    </div>

                    <div class = "card-content-container">

                        <h1 class = "card-title">Login</h1>

                        <form onsubmit = "onSubmitEvent(event)">

                            <input
                                class = "login-input"
                                type = "password"
                                id = "apiKey"
                                name = "apiKey"
                                placeholder = "API key..."
                                required
                            >

                            <p id = "login-form-feedback" class = "form-error"></p>
                            <button class = "login-button" type = "submit">Submit</button>

                        </form>

                    </div>

                </div>

            </div>

        </main>

    </body>

    <script>

        function onSubmitEvent(event) {

            event.preventDefault();
            document.getElementById("login-form-feedback").innerText = "";

            fetch("/admin/api/session", {

                method: "POST",

                headers: {

                    "Authorization": event.target.apiKey.value
                }
            })
            .then(response => {

                switch(response.status) {

                    case 200:

                        localStorage.setItem("GattosLabIsLoggedIn", "true");
                        globalThis.location = "./index.html";

                    break;

                    case 401: document.getElementById("login-form-feedback").innerText = "Unauthorized"; break;
                    default: document.getElementById("login-form-feedback").innerText = `Error: ${response.status}`;
                }
            })
            .catch(error_ => {

                document.getElementById("login-form-feedback").innerText = `Error: ${error_}`;
            });
        }

    </script>

</html>
